<script>
    // LOAD SAVED DATA WHEN APP OPENS
    window.onload = function() {
        const savedHistory = localStorage.getItem('f5_data');
        if (savedHistory) {
            document.getElementById('history').value = savedHistory;
        }
    };

    function generateFantasy5() {
        const historyBox = document.getElementById('history');
        const historyText = historyBox.value;

        // SAVE TO PHONE MEMORY
        localStorage.setItem('f5_data', historyText);

        const numbers = historyText.match(/\b([1-9]|[123][0-9]|4[01])\b/g);
        if (!numbers || numbers.length < 5) {
            alert("Please paste more history data!");
            return;
        }

        let counts = {};
        for (let i = 1; i <= 41; i++) counts[i] = 0;
        numbers.forEach(n => { if(counts[parseInt(n)] !== undefined) counts[parseInt(n)]++; });
        let sorted = Object.keys(counts).sort((a, b) => counts[b] - counts[a]);

        document.getElementById('resultsArea').style.display = 'block';
        for (let i = 0; i < 5; i++) {
            let line = [];
            let pool = (i < 2) ? sorted.slice(0, 15) : (i === 2) ? Array.from({length: 41}, (_, k) => (k+1).toString()) : sorted.slice(-15);
            while(line.length < 5) {
                let n = pool[Math.floor(Math.random() * pool.length)];
                if(!line.includes(n)) line.push(n);
            }
            line.sort((a, b) => a - b);
            document.getElementById('r' + i).innerText = line.join(' ');
        }
    }
</script>
